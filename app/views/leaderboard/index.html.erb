<div class="relative min-h-screen flex flex-col p-6 pb-28">
  <!-- Header -->
  <header class="flex items-center justify-between mb-8">
    <button class="text-2xl text-gray-400 hover:text-white">
      <i class="fas fa-cog"></i>
    </button>
    <h1 class="text-lg font-semibold text-text-primary-light dark:text-text-primary-dark">Groups</h1>
    <button class="text-xl text-gray-400 hover:text-white">
      <i class="fas fa-filter"></i>
    </button>
  </header>

  <main class="flex-grow">
    <!-- Page Title -->
    <section class="mb-6">
      <h2 class="text-4xl font-bold text-text-primary-light dark:text-text-primary-dark">Team Groups</h2>
      <p class="text-sm text-text-secondary-light dark:text-text-secondary-dark mt-2">Manage your teams and track progress</p>
    </section>

    <!-- Groups Grid -->
    <section class="space-y-4">
      <% @groups.each do |group| %>
        <article class="group-card">
          <!-- Group Header -->
          <div class="group-header">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <% if group.friend&.profile_picture_url.present? %>
                  <%= image_tag group.friend.profile_picture_url, alt: group.friend.name, class: "w-12 h-12 rounded-full object-cover" %>
                <% else %>
                  <div class="w-12 h-12 rounded-full bg-secondary/30 flex items-center justify-center">
                    <i class="fas fa-user text-xl text-secondary"></i>
                  </div>
                <% end %>
                <div>
                  <h3 class="group-title"><%= group.friend&.name || "No Friend Assigned" %></h3>
                  <p class="group-subtitle"><%= group.name %></p>
                </div>
              </div>
              <div class="text-right">
                <div class="group-points"><%= group.total_points.to_i %></div>
                <div class="text-xs text-text-secondary-light dark:text-text-secondary-dark">points</div>
              </div>
            </div>
            <div class="mt-3 flex items-center gap-2">
              <span class="text-xs text-text-secondary-light dark:text-text-secondary-dark">Multiplier:</span>
              <span class="group-multiplier">Ã—<%= group.multiplier.to_i %></span>
            </div>
          </div>

          <!-- Teams List -->
          <div class="p-4 space-y-3">
            <% group.teams.each do |team| %>
              <div class="flex items-center justify-between p-3 bg-background-light dark:bg-background-dark rounded-xl">
                <div class="flex items-center gap-3 flex-1">
                  <% if team.flag_url.present? %>
                    <%= image_tag team.flag_url, alt: team.name, class: "h-8 w-8 rounded-full object-cover" %>
                  <% else %>
                    <div class="h-8 w-8 rounded-full bg-secondary/20 flex items-center justify-center">
                      <span class="text-xs font-bold text-secondary"><%= team.name[0] %></span>
                    </div>
                  <% end %>
                  <div class="flex-1">
                    <p class="font-semibold text-text-primary-light dark:text-text-primary-dark"><%= team.name %></p>
                    <p class="text-xs text-text-secondary-light dark:text-text-secondary-dark">
                      <%= team.matches.where(status: 'PostEvent').count %> matches played
                    </p>
                  </div>
                  <div class="text-right mr-3">
                    <div class="text-lg font-bold text-text-primary-light dark:text-text-primary-dark"><%= team.points.to_i %></div>
                    <div class="text-xs text-text-secondary-light dark:text-text-secondary-dark">pts</div>
                  </div>
                </div>

                <!-- Progressed Toggle -->
                <div class="flex items-center gap-2">
                  <%= form_with url: update_team_progress_leaderboard_path(team), method: :patch, local: true, class: "flex items-center" do %>
                    <%= hidden_field_tag 'authenticity_token', form_authenticity_token %>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <%= check_box_tag :progressed, team.id, team.progressed?,
                          class: "sr-only peer",
                          onchange: 'this.form.submit();' %>
                      <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                  <% end %>
                  <% if team.progressed? %>
                    <i class="fas fa-check-circle text-accent-live"></i>
                  <% end %>
                </div>
              </div>

              <!-- Match Results -->
              <% if team.matches.where(status: 'PostEvent').any? %>
                <div class="ml-11 text-xs text-text-secondary-light dark:text-text-secondary-dark space-y-1">
                  <% team.matches.where(status: 'PostEvent').limit(3).each do |match| %>
                    <div class="flex items-center gap-2">
                      <i class="fas fa-circle text-[4px]"></i>
                      <span>vs <%= match.home_team_id == team.id ? match.away_team.name : match.home_team.name %>: <%= match.result_for(team) %></span>
                    </div>
                  <% end %>
                </div>
              <% end %>
            <% end %>
          </div>
        </article>
      <% end %>
    </section>
  </main>
</div>

<%= render 'layouts/bottom_nav' %>
